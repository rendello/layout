
"""
Table adapted from Wikipedia article: "Inuktitut syllabics".
See: https://en.wikipedia.org/wiki/Inuktitut_syllabics
"""

BASE_TABLE = [
    "	á	áƒ	á„	á…	á†	áŠ	á‹	",
    "p	á¯	á±	á²	á³	á´	á¸	á¹	á‘‰",
    "t	á‘Œ	á‘Ž	á‘	á‘	á‘‘	á‘•	á‘–	á‘¦",
    "k	á‘«	á‘­	á‘®	á‘¯	á‘°	á‘²	á‘³	á’ƒ",
    "g	á’‰	á’‹	á’Œ	á’	á’Ž	á’	á’‘	á’¡",
    "m	á’£	á’¥	á’¦	á’§	á’¨	á’ª	á’«	á’»",
    "n	á“€	á“‚	á“ƒ	á“„	á“…	á“‡	á“ˆ	á“",
    "s	á“­	á“¯	á“°	á“±	á“²	á“´	á“µ	á”…",
    "l	á““	á“•	á“–	á“—	á“˜	á“š	á“›	á“ª",
    "j	á”¦	á”¨	á”©	á”ª	á”«	á”­	á”®	á”¾",
    "jj	á‘¦á”¦	á‘¦á”¨	á‘¦á”©	á‘¦á”ª	á‘¦á”«	á‘¦á”­	á‘¦á”®	á‘¦á”¾",
    "v	á•“	á••	á•–	á•—	á•˜	á•™	á•š	á•",
    "r	á•‚	á•†	á•‡	á•ˆ	á•‰	á•‹	á•Œ	á•",
    "q	á™¯	á•¿	á–€	á–	á–‚	á–ƒ	á–„	á–…",
    "qq	á–…á‘«	á–…á‘­	á–…á‘®	á–…á‘¯	á–…á‘°	á–…á‘²	á–…á‘³	á–…á’ƒ",
    "ng	á™°	á–	á–	á–‘	á–’	á–“	á–”	á–•",
    "nng		á™±	á™²	á™³	á™´	á™µ	á™¶	á––",
    "Å‚		á– 	á–¡	á–¢	á–£	á–¤	á–¥	á–¦",
    "b								á–¯",
    "h								á•¼",
    "Ê¼								á‘Š",
]

NUNAVIK_TABLE = [
    "h	á•´	á•µ	á•¶	á•·	á•¸	á•¹	á•º	á•»",
]

NATSILIK_TABLE = [
    "Å¡		ð‘ª¶	ð‘ª·	ð‘ª¸	ð‘ª¹	ð‘ªº	ð‘ª»	",
    "h		ð‘ª°	ð‘ª±	ð‘ª²	ð‘ª³	ð‘ª´	ð‘ªµ	",
    "Å™		á–¨	á–©	á–ª	á–«	á–¬	á–­	á–®",
]

def escape_empty(s):
    if s == "":
        return None
    else:
        return s


def extract_series(table):
    col_ids = ["latin", "ai", "i", "ii", "u", "uu", "a", "aa", "final"]

    series = []
    for row in table:
        cols = row.split("\t")
        series.append({key: escape_empty(cols[i]) for i, key in enumerate(col_ids)})
    return series


def encode(s):
    return repr(s.encode("utf8"))[2:][:-1]


def to_syl_line(consonant, vowel, syllabic):
    line = f'''    b"{encode(consonant) or ""}{vowel or ""}" => "{syllabic}",'''
    if "\\x" in line:
        line += f'''\t/* {consonant}{vowel or ""} */\n'''
    else:
        line += "\n"
    return line


def to_syl(series_table):
    s = str()

    for series in series_table:
        consonant = series["latin"] or ""

        match series["final"]:
            case str(syllabic):
                s += to_syl_line(consonant, None, syllabic) 

        for vowel in ["ai", "i", "ii", "u", "uu", "a", "aa"]:
            match series[vowel]:
                case str(syllabic):
                    s += to_syl_line(consonant, vowel, syllabic) 
    return s

# TODO: Count max bytes for syllabics and latin letters for max key lengths.

dialects = [
    ("BASE", BASE_TABLE),
    ("NUNAVIK", NUNAVIK_TABLE),
    ("NATSILIK", NATSILIK_TABLE)
]


def realign_comments(s):
    buffer = ""
    max_left_length = 0

    for line in s.split("\n"):
        if "\\x" in line and "\t" in line:
            left, _ = line.split("\t")
            if len(left) > max_left_length:
                max_left_length = len(left)

    for line in s.split("\n"):
        if "\\x" in line and "\t" in line:
            left, right = line.split("\t")

            right_aligned = " " * ((max_left_length // 4 + 1) * 4 - len(left)) + right
            buffer += left + right_aligned + "\n"
        else:
            buffer += line + "\n"

    return buffer


def generate():
    buffer = (
        '''/* =========================================== */\n'''
        '''/* AUTOGENERATED: See `../scripts/generate.py` */\n'''
        '''/* =========================================== */\n\n'''
        '''use phf::phf_map;\n\n'''
        '''type PMap = phf::Map<&'static [u8], &'static str>;\n\n'''
    )

    for (dialect, table) in dialects:
        series_table = extract_series(table)

        buffer += "pub static " + dialect + "_TO_SYL: PMap = phf_map! {\n"
        buffer += to_syl(series_table)
        buffer += "};\n\n"

    buffer = realign_comments(buffer)
    return buffer


print(realign_comments(generate()))